<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ù†ØµÙ‘Ø© - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ§Ø¬Ø±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:"Tajawal",system-ui;
      background:#020617;
      color:#e5e7eb;
      min-height:100vh;
      padding:16px;
    }
    .wrap{
      max-width:900px;
      margin:0 auto;
    }
    h1{
      font-size:20px;
      margin-bottom:10px;
    }
    .box{
      background:#020617;
      border-radius:12px;
      border:1px solid #1f2937;
      padding:12px;
      margin-bottom:12px;
    }
    label{
      font-size:12px;
      display:block;
      margin-bottom:2px;
      color:#9ca3af;
    }
    input{
      width:100%;
      padding:7px;
      border-radius:8px;
      border:1px solid #374151;
      background:#020617;
      color:#e5e7eb;
      margin-bottom:8px;
      font-size:13px;
    }
    button{
      padding:7px 12px;
      border-radius:999px;
      border:none;
      cursor:pointer;
      font-size:13px;
      font-family:inherit;
    }
    .btn-main{background:#22c55e;color:#020617;font-weight:600;}
    .btn-outline{background:transparent;color:#e5e7eb;border:1px solid #4b5563;}
    .row{display:flex;gap:8px;flex-wrap:wrap;}
    .row>div{flex:1;min-width:160px;}
    .small{font-size:11px;color:#9ca3af;}
    table{width:100%;border-collapse:collapse;font-size:12px;margin-top:8px;}
    th,td{border-bottom:1px solid #111827;padding:6px 4px;text-align:right;}
    th{color:#9ca3af;font-weight:500;}
    .badge{
      display:inline-block;
      padding:2px 8px;
      border-radius:999px;
      font-size:11px;
    }
    .badge-active{background:#22c55e33;color:#22c55e;}
    .badge-off{background:#f9731633;color:#f97316;}
    a.link{
      color:#38bdf8;
      text-decoration:none;
      word-break:break-all;
    }
    .top-alert{
      margin-bottom:10px;
      font-size:12px;
      color:#fde68a;
    }
  </style>
</head>
<body>
<div class="wrap">
  <h1>Ù„ÙˆØ­Ø© ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ù†ØµÙ‘Ø© â€“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ§Ø¬Ø±</h1>
  <div class="top-alert">
    Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ùƒ ÙÙ‚Ø·ØŒ Ù„Ø§ ØªØ¹Ø·ÙŠ Ø±Ø§Ø¨Ø·Ù‡ Ù„Ø£ÙŠ Ø²Ø¨ÙˆÙ† ğŸ›‘
  </div>

  <div class="box">
    <h2 style="font-size:15px;margin-bottom:6px;">Ø¥Ù†Ø´Ø§Ø¡ Ù…ØªØ¬Ø± Ø¬Ø¯ÙŠØ¯</h2>
    <div class="small" id="ownerInfo"></div>
    <div style="height:6px;"></div>

    <div class="row">
      <div>
        <label>Store ID (Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØŒ Ø¨Ø¯ÙˆÙ† ÙØ±Ø§ØºØ§Øª)</label>
        <input id="storeIdInput" placeholder="Ù…Ø«Ø§Ù„: telesat1 Ø£Ùˆ basim-shop">
      </div>
      <div>
        <label>Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø± (ÙŠØ¸Ù‡Ø± Ù„Ù„Ø¹Ù…ÙŠÙ„)</label>
        <input id="storeNameInput" placeholder="Ù…Ø«Ø§Ù„: Ù…ØªØ¬Ø± Ø¨Ø§Ø³Ù… Ù„Ù„Ø³ØªÙ„Ø§ÙŠØª">
      </div>
    </div>

    <div class="row">
      <div>
        <label>Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</label>
        <input id="storeWhatsInput" placeholder="Ù…Ø«Ø§Ù„: 9647XXXXXXXXX">
      </div>
      <div>
        <label>Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ø£Ø¯Ù…Ù† Ù„Ù„Ù…ØªØ¬Ø±</label>
        <input id="storeEmailInput" placeholder="email@example.com">
      </div>
    </div>

    <div class="row">
      <div>
        <label>Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ø£Ø¯Ù…Ù† Ù„Ù„Ù…ØªØ¬Ø±</label>
        <input id="storePassInput" placeholder="Ø§Ø®ØªØ± ÙƒÙ„Ù…Ø© Ø³Ø±" type="password">
      </div>
    </div>

    <button class="btn-main" id="createStoreBtn">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ØªØ¬Ø±</button>
    <div class="small" id="createMsg" style="margin-top:6px;"></div>
  </div>

  <div class="box">
    <h2 style="font-size:15px;margin-bottom:6px;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØ§Ø¬Ø±</h2>
    <div class="small">ØªÙ‚Ø¯Ø± ØªÙˆÙ‚Ù/ØªØ´ØºÙ„ Ø£ÙŠ Ù…ØªØ¬Ø±ØŒ ÙˆØªØ§Ø®Ø° Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø§Ù‡Ø² Ù„Ù„Ø²Ø¨ÙˆÙ†.</div>
    <div id="storesTableWrap"></div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<script>
  // ÙƒÙ„Ù…Ø© Ø³Ø± ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ù†ØµØ© (Ø¥Ù„Ùƒ Ø¥Ù†Øª) Ø­ØªÙ‰ Ù…Ø§ Ø­Ø¯ ÙŠØ¯Ø®Ù„ Ù‡Ù†Ø§
  const MASTER_ADMIN_CODE = "999999"; // ØºÙŠÙ‘Ø±Ù‡Ø§ Ù„Ø´ÙŠ Ø¨Ø³ Ø¥Ù†Øª ØªØ¹Ø±ÙÙ‡

  const firebaseConfig = {
    apiKey: "AIzaSyAEX8BjlYjsHOxDwD-Wu9qyFyIR3Wb6RxQ",
    authDomain: "mtgr-24718.firebaseapp.com",
    projectId: "mtgr-24718",
    storageBucket: "mtgr-24718.firebasestorage.app",
    messagingSenderId: "385919783070",
    appId: "1:385919783070:web:64f2703ec8cc0fd1c5ab8f"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const ownerInfo      = document.getElementById("ownerInfo");
  const storeIdInput   = document.getElementById("storeIdInput");
  const storeNameInput = document.getElementById("storeNameInput");
  const storeWhatsInput= document.getElementById("storeWhatsInput");
  const storeEmailInput= document.getElementById("storeEmailInput");
  const storePassInput = document.getElementById("storePassInput");
  const createStoreBtn = document.getElementById("createStoreBtn");
  const createMsg      = document.getElementById("createMsg");
  const storesTableWrap= document.getElementById("storesTableWrap");

  (function askMaster(){
    const code = prompt("Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø³Ø± ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ù†ØµØ©:");
    if(code !== MASTER_ADMIN_CODE){
      alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©ØŒ Ù…Ø§ ØªÙ‚Ø¯Ø± ØªØ¯Ø®Ù„.");
      document.body.innerHTML = "<h2 style='color:white;text-align:center;margin-top:40px;'>Ø¯Ø®ÙˆÙ„ Ù…Ø±ÙÙˆØ¶</h2>";
    } else {
      ownerInfo.textContent = "ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ù†ØµØ© âœ…";
      loadStores();
    }
  })();

  function baseStoreLink(storeId){
    const url = new URL(window.location.href);
    // Ù†ÙØªØ±Ø¶ Ø£Ù† index.html Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯
    url.pathname = url.pathname.replace("owner-admin.html", "index.html");
    url.search = "?store=" + encodeURIComponent(storeId);
    return url.toString();
  }

  createStoreBtn.addEventListener("click", async () => {
    const id    = storeIdInput.value.trim();
    const name  = storeNameInput.value.trim();
    const whats = storeWhatsInput.value.trim();
    const email = storeEmailInput.value.trim();
    const pass  = storePassInput.value.trim();

    createMsg.textContent = "";

    if(!id || !email || !pass){
      createMsg.textContent = "ğŸ”´ Ù„Ø§Ø²Ù… ØªÙƒØªØ¨ Store ID + Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ + Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.";
      return;
    }
    if(/\s/.test(id)){
      createMsg.textContent = "ğŸ”´ Store ID Ø¨Ø¯ÙˆÙ† ÙØ±Ø§ØºØ§Øª. Ø§Ø³ØªØ®Ø¯Ù… - Ø£Ùˆ _ Ø¥Ø°Ø§ ØªØ­Ø¨.";
      return;
    }

    try{
      const doc = await db.collection("stores").doc(id).get();
      if(doc.exists){
        createMsg.textContent = "âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹Ø±Ù Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ù‚Ø¨Ù„. Ø¬Ø±Ù‘Ø¨ Ø§Ø³Ù… Ø«Ø§Ù†ÙŠ.";
        return;
      }

      await db.collection("stores").doc(id).set({
        name: name || id,
        whatsapp: whats || null,
        adminEmail: email,
        adminPassword: pass,
        active: true,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      const link = baseStoreLink(id);
      createMsg.textContent = "âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ØªØ¬Ø±. Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ØªØ¬Ø±: " + link;
      storeIdInput.value = storeNameInput.value = storeWhatsInput.value = storeEmailInput.value = storePassInput.value = "";
      loadStores();
    }catch(e){
      console.error(e);
      createMsg.textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡.";
    }
  });

  function loadStores(){
    db.collection("stores").orderBy("createdAt","desc").onSnapshot(snap=>{
      if(snap.empty){
        storesTableWrap.innerHTML = "<p class='small'>Ù…Ø§ÙƒÙˆ Ù…ØªØ§Ø¬Ø± Ø¨Ø¹Ø¯.</p>";
        return;
      }
      let html = "<table><thead><tr><th>Ø§Ù„Ù…Ø¹Ø±Ù</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„Ø±Ø§Ø¨Ø·</th><th>ØªØ­ÙƒÙ…</th></tr></thead><tbody>";
      snap.forEach(doc=>{
        const d = doc.data();
        const link = baseStoreLink(doc.id);
        html += `
          <tr>
            <td>${doc.id}</td>
            <td>${d.name || "-"}</td>
            <td>
              <span class="badge ${d.active ? "badge-active":"badge-off"}">
                ${d.active ? "Ø´ØºØ§Ù„":"Ù…ÙˆÙ‚ÙˆÙ"}
              </span>
            </td>
            <td><a class="link" href="${link}" target="_blank">${link}</a></td>
            <td>
              <button class="btn-outline" onclick="toggleStore('${doc.id}', ${d.active ? "true":"false"})">
                ${d.active ? "Ø¥ÙŠÙ‚Ø§Ù":"ØªØ´ØºÙŠÙ„"}
              </button>
            </td>
          </tr>
        `;
      });
      html += "</tbody></table>";
      storesTableWrap.innerHTML = html;
    });
  }

  window.toggleStore = async function(storeId, isActive){
    const confirmMsg = isActive ? "ØªØ±ÙŠØ¯ ØªÙˆÙ‚Ù‘Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØ¬Ø±ØŸ" : "ØªØ±ÙŠØ¯ ØªØ´ØºÙ‘Ù„ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØ¬Ø±ØŸ";
    if(!confirm(confirmMsg)) return;
    await db.collection("stores").doc(storeId).update({active: !isActive});
  }
</script>
</body>
</html>
